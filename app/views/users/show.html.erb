<% content_for :hide_navbar, true %>

<div class="profile-page container">

  <div class="profile-sprite-outer">
    <div class="profile-sprite-holder">
      <%= image_tag "character-sprites/Samurai/player_character.png", class: "profile-sprite" %>
    </div>
  </div>

  <div class="card profile-card">
    <div class="profile-stats">
      <div class="stat-box">
        <span class="stat-value"><%= @levels_cleared %></span>
        <span class="stat-label">Levels<br>Cleared</span>
      </div>

      <div class="stat-box">
        <span class="stat-value"><%= @avg_perc_correct %>%</span>
        <span class="stat-label">Question<br>Accuracy</span>
      </div>

      <div class="stat-box">
        <span class="stat-value"><%= @days_streak %></span>
        <span class="stat-label">Day<br>Streak</span>
      </div>
    </div>
  </div>

  <div class="card profile-card">
    <div class="difficulty">
      <label for="jlpt-level">Difficulty</label>
      <%= select_tag :difficulty,
        options_for_select([["N1", "N1"], ["N2", "N2"], ["N3", "N3"]], @user.japanese_difficulty),
        class: "form-select" %>
    </div>
  </div>
  
<div id="leaderboard" class="card profile-card">
  <h3 class="leaderboard-title">Leaderboard</h3>

  <div class="leaderboard-toggle">
    <button class="toggle-btn active" data-target="global">Global</button>
    <button class="toggle-btn" data-target="friends">Friends</button>
  </div>

  <div id="leaderboard-global" class="leaderboard-list">
    <% @top_5_global.each_with_index do |user, index| %>
      <div class="leaderboard-row">
        <span class="leaderboard-rank"><%= index + 1 %></span>
        <span class="leaderboard-name"><%= user.character_name %></span>
        <span class="leaderboard-level">LVL <%= user.level %></span>
      </div>
    <% end %>
  </div>

  <div id="leaderboard-friends" class="leaderboard-list" style="display: none;">
    <% @top_5_friends.each_with_index do |user, index| %>
      <div class="leaderboard-row">
        <span class="leaderboard-rank"><%= index + 1 %></span>
        <span class="leaderboard-name"><%= user.character_name %></span>
        <span class="leaderboard-level">LVL <%= user.level %></span>
      </div>
    <% end %>
  </div>
</div>
  
  <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200 shadow-inner mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Connect with other Heroes</h3>
    
    <%# Using form_with with direct URL targeting the controller action %>
    <%= form_with(url: add_friend_users_path, method: :post, local: true, class: "flex flex-col sm:flex-row gap-3") do |form| %>
      
      <%# Input field for the friend's identifier (Character Name) %>
      <%= form.text_field :identifier, 
          placeholder: "Enter hero's Character Name", 
          required: true, 
          class: "flex-1 p-3 border border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 transition-colors w-full shadow-sm text-gray-700" %>
      
      <%# Submission button %>
      <%= form.button "Add Hero", 
          type: 'submit', 
          class: "bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:bg-blue-700 transition-colors flex items-center justify-center whitespace-nowrap transform active:scale-95" %>
    <% end %>
    
    <p class="text-sm text-gray-500 mt-3 italic">
        Find a user's exact character name (case sensitive) to add them.
    </p>
</div>

<div class="card profile-card">
  <%= button_to "Logout", destroy_user_session_path, method: :delete, class: "btn btn-action" %>
</div>

</div>
<%= render 'shared/bottom_navbar' %>
